-------------------------
title: 500G磁盘凭空消失！
tags: http
categories: Expand
date: 2019-04-12 16:42:41
-------------------------


### Description
最近有一台磁盘容量500G的机器频繁出现磁盘容量不足，每次出现都只能重新启动机器，次数多了就想用一个一劳永逸的办法给他解决掉

### 问题查看步骤
1.查看磁盘空间剩余容量

   ```jshelllanguage
    df -h
   ```
   
2.如果磁盘容量已经用尽，找出占用容量最大的目录

   ```jshelllanguage
    du -s /* | sort -nr
   ```
   

<div class="wrap effect" style="box-shadow:0px 1px 4px rgba(0,0,0,0.3),0 0 40px rgba(0,0,0,0.1) inset;
	webkit-box-shadow:0px 1px 4px rgba(0,0,0,0.3),0 0 40px rgba(0,0,0,0.1) inset;
	moz-box-shadow:0px 1px 4px rgba(0,0,0,0.3),0 0 40px rgba(0,0,0,0.1) inset;
	o-box-shadow:0px 1px 4px rgba(0,0,0,0.3),0 0 40px rgba(0,0,0,0.1) inset;">
	<img src="/picture/http/du-s.jpg">
</div>


3.假设 `/root` 目录占用最多，查看root目录下哪个目录占用磁盘最多

   ```jshelllanguage
    du -s /root/* |sort -nr
   ```

4.找到占用最多的文件，选择性的进行删除，如果删除后仍未解决，可以查看被删除的文件是否仍然被进程所占用而没有实际删除

   ```jshelllanguage
    lsof |grep delete
   ```
最后结束占用进程

我发现我的项目中 `nohup.out` 文件最大，而且删除了也还是被项目占用，结束进程后又要重启项目，非常麻烦，下面我们来了解一下 `nohup.out` 和如何解决此文件过大的问题

### nohup 后台方式启动项目产生的 nohup.out 文件过大的问题解决记录

原因：使用 `nohup` 执行 `java` 项目时，未指定日志去向，会自动在当前目录生成一个 `nohup.out` 文件来存放请求日志，而这个日志文件中的日志策略根本不会使用项目中的配置，所有的日志都会打印记录，所以会导致这个文件非常大，

1.指定日志文件去到系统空洞/垃圾桶 `/dev/null`

   ```
    nohup *** >> /dev/null 1 > /var/log/app.log &
   ```
   
2.指定日志去向，定时清除

2.1指定日志输出到 `/var/log/app.log`
   ```
    nohup *** >> /var/log/app.log &
   ```
   
2.2编写 `cron` 定时任务脚本文件

   ```jshelllanguage    
    vim app.cron
   ```
   
2.3在定时任务脚本文件写入，每天18点清除 
   ```
    0 18 * * * cat /dev/null > /var/log/app.log
   ```
   
2.4执行

   ```
    crontab /app/app.cron > /var/log/corn.log
   ```
2.5查看

   ```
    crontab -l
   ```

<div class="wrap effect" style="box-shadow:0px 1px 4px rgba(0,0,0,0.3),0 0 40px rgba(0,0,0,0.1) inset;
	webkit-box-shadow:0px 1px 4px rgba(0,0,0,0.3),0 0 40px rgba(0,0,0,0.1) inset;
	moz-box-shadow:0px 1px 4px rgba(0,0,0,0.3),0 0 40px rgba(0,0,0,0.1) inset;
	o-box-shadow:0px 1px 4px rgba(0,0,0,0.3),0 0 40px rgba(0,0,0,0.1) inset;">
	<img src="/picture/http/cronjob.jpg" alt="定时任务" title="定时任务">
</div>

3.
